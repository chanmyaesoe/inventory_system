<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="net.javaguides.springboot.springboothelloworldtutorial.mapper.ProductMapper">
    <resultMap id="productMap" type="product" autoMapping="true">
    </resultMap>
    <resultMap id="BaseMap" type="net.javaguides.springboot.springboothelloworldtutorial.entity.Product">
        <id property="id" column="id" />
        <result property="product_name" column="product_name" />
        <result property="barcode" column="barcode" />
        <result property="current_count" column="current_count" />
        <result property="created_at" column="created_at" />
        <result property="last_stocked_at" column="last_stocked_at" />
        <!--JavaType and ofType They are all used to specify object types, but JavaType Is used to specify pojo The type of attribute in the ofType Specifies that maps to list In collection properties pojo Type of -->
        <collection property="productDetails" ofType="net.javaguides.springboot.springboothelloworldtutorial.entity.ProductDetail" javaType="java.util.ArrayList">
            <id property="id" column="product_details_id" />
            <result property="new_count" column="new_count" />
            <result property="remaining_count" column="remaining_count" />
            <result property="price" column="price" />
        </collection>

    </resultMap>
    <sql id="Base_Column_List">
        id, product_name, barcode,created_at
    </sql>
<!--    <select id="getAll" resultMap="productMap">-->
<!--        select-->
<!--        <include refid="Base_Column_List"/>-->
<!--        from products-->
<!--    </select>-->
    <select id="getAll" resultMap="BaseMap">
    select products.*,product_details.id as product_details_id,product_details.product_id ,product_details.price,product_details.new_count,product_details.remaining_count
    from products
    left  join product_details on products.id = product_details.product_id
    <if test="pageSize != 0">
        limit #{pageNum}, #{pageSize}
    </if>
</select>

    <!--Save Product-->
    <insert id="saveProduct"  useGeneratedKeys="true" keyProperty="id" parameterType="product">
        insert into products(product_name,barcode,current_count, created_at)  values(#{product_name},#{barcode},0,NOW())
    </insert>

    <!--adopt Id delete product-->
    <delete id="deleteProductById" parameterType="int">
       delete from products where id =#{id}
    </delete>

    <!--Update this product information-->
    <update id="updateProduct" parameterType="int">
       update products set stocked_at =  #{stocked_at},product_name =  #{product_name}
       where id = #{id}
    </update>

    <select id="selectByCount" resultMap="productMap">
        select
        <include refid="Base_Column_List"/>
        from products where current_count &lt; 6
    </select>

    <!-- Query Count-->
    <select id="getCount" resultType="Product">
        select count(id) as id from products
    </select>
</mapper>